<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Searchbox inspection suite</title>

  <!-- SCRIPTS -->
  <script type="text/javascript" src="../node_modules/jquery/dist/jquery.js"></script>
  <script type="text/javascript" src="../node_modules/underscore/underscore.js"></script>
  <script type="text/javascript" src="js/feature_description.js"></script>
  <script type="text/javascript" src="js/combo.js"></script>

  <!-- coffee -co examples combojs.coffee -->
  <script type="text/javascript" src="data_1275.json"></script>
  <script type="text/javascript" src="../lib/coffee-script.js"></script>
  <script type="text/coffeescript">

    map2text = (model) ->
      summary = model.statusSummary
      uValue = " (U: " + model.e10_Case_Building_Zone_BuildingPart_UValue + ")"
      summary + " " + uValue

    map2result = (enable) ->
      (model) ->
        even = if(typeof enable is "function") then enable(model) else enable
        id: model.id
        title: "title"
        text: map2text(model)
        true: even

    render_test = (id, msg, data) ->
      $("<div id='wrapper-#{id}'>")
        .append("<h3>#{msg}</h3>")
        .append("<div id='#{id}'></div>")
        .append('<br />')
        .appendTo('body')

      combo = new Combo()
      combo.load(data)
      combo.appendTo("##{id}")
      combo.renderFullList()

    openListMaybe = (selector) ->
      setTimeout (() -> $("#{selector} .combo-button").click()), 0

    data_10000 = (
      {
        id: i;
        text: "hello world, we are legion and my name is mister #{i} and this is my loooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooong string",
        true: i%2
      } for i in [0...10000])

    $ ->
      if data_10000.length isnt 10000
        throw Error("wrong test data! " + data_10000.length)
      if _data_1275.length isnt 1275
        throw Error("wrong test data! " + _data_1275.length)

      render_test('test-1', "Combojs with empty list", [])
      render_test('test-2', "Combojs with disabled list", _data_1275.map map2result(false))
      render_test('test-3', "Combojs with enabled list", _data_1275.map map2result(true))

      filter = (() ->
                even = true
                () -> even = !even; return even)()
      render_test('test-4', "Combojs with half enabled list", _data_1275.map map2result(filter))
      render_test('test-5', "Combojs with 10000 elements", data_10000)
      render_test('test-6', "Combojs with selected element", _data_1275.map map2result(true))

      openListMaybe '#wrapper-test-6'

      $('body').append("<div id='features'><pre>#{_feature_description}</pre></div>")
  </script>
  <link rel="stylesheet" href="css/combo.css" />
  <style>
    #wrapper-test-6 {
      position: absolute;
      left: 600px;
      top: 0px;
    }

    #features {
      position: absolute;
      left: 1200px;
      top: 0px;
    }
  </style>
</head>
<body />
</html>
